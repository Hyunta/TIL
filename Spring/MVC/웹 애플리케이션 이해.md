## HTTP

http 메시지에 모든 것을 전송



## 웹 서버 vs 웹 애플리케이션 서버

#### 웹서버:

정적 리소스 제공 ( html, css, js) 

 ex) nginx, apache

#### 웹 애플리케이션 서버:

WAS는 프로그램 코드를 실행해서 애플리케이션 로직 수행 

서블릿 JSP 스프링MVC

ex) 톰캣, 제티

하지만 **둘의 차이는 모호하다**.



### 웹 시스템 구성 - WAS, DB 구성

애플리케이션 로직은 비싸다, 정적 리소스 때문에 수행이 어려울 수 있다.

WAS 장애시 오류 화면도 노출 불가능



### 웹 시스템 구성 - WEB, WAS, DB 구성

정적 리소스는 웹 서버가 관리한다.

애플리케이션 로직은 WAS에서 담당한다.

더 안정적이다.



## 서블릿

<img src="/Users/kimhyuntae/Library/Application Support/typora-user-images/image-20220422172522431.png" alt="image-20220422172522431" style="zoom: 50%;" />

비지니스 로직을 제외한 나머지 과정을 서블릿에서 처리해준다.

웹 브라우저에서 요청 메시지를 기반으로 request 생성, 서블릿 컨테이너 에서 reponse를 HTTP로 반환



### 서블릿 컨테이너

직접 서블릿을 생성하는 것이 아니다. 코드를 작성하면 WAS 안에 서블릿 컨테이너가 서블릿 객체를 싱글톤으로 자동으로 생성해준다. 생명 주기까지 관리해준다.

싱글턴으로 관리되기 때문에 **공유 변수 사용 주의**

JSP도 서블릿으로 변환 되어서 사용

동시 요청을 위한 멀티 쓰레드 처리 지원



## 동시 요청 - 멀티 쓰레드

애플리케이션 코드를 하나하나 순차적으로 실행하는 것은 쓰레드

쓰레드는 한번에 하나의 코드 라인만 수행

동시 처리가 필요하면 쓰레드를 추가로 생성



**요청마다 쓰레드를 생성하면** 

- 장점
  - 동시 요청 처리 가능
  - 하나가 지연되도 나머지 정상 작동
- 단점
  - 쓰레드 생성 비용은 매우 비싸다
    - 고객의 요청이 올 때 마다 쓰레드를 생성하면, 응답 속도가 늦어진다.
  - 쓰레드는 컨텍스트 스위칭 비용이 발생한다
  - 쓰레드 생성에 제한이 없다.
    - 요청이 너무 많으면 CPU가 메모리 임계점을 넘어서 서버가 죽을 수 있다.

**쓰레드 풀**

- 특징

  필요한 쓰레드를 쓰레드 풀에 보관하고 관리한다.

  쓰레드 풀에 생성 가능한 쓰레드들의 최대치를 관리한다.

- 사용

  쓰레드가 필요하면, 이미 생성되어 있는 쓰레드를 풀에서 꺼내서 사용한다.

  끝나면 반납한다.

- 장점

  쓰레드가 미리 생성되어 있으므로, 쓰레드를 생성하고 종료하는 비용이 절약되고, 응답 시간이 빠르다.

주요 튜닝 포인트는 **최대 쓰레드**



## 백엔드 개발자가 커버해야할 영역

정적 리소스 : 고정된 HTML 파일, CSS, JS 이미지, 영상등을 제공

동적 리소스는 WAS가 DB를 통해서 받아와서 동적으로 생성(뷰템플릿 - JSP, 타임리프)

HTTP API:  데이터를 전달한다, 주로 JSON 형식을 사용한다. 다양한 시스템에서 호출

데이터만 주고받고 UI가 필요하면 클라이언트가 별도로 처리

백엔드 개발자는 3가지(정적리소스, 동적리소스, API)를 고민해야한다.



**SSR 서버 사이드 렌더링**

서버에서 최종 HTML을 생성해서 클라이언트에 전달

**CSR 클라이언트 사이드 렌더링**

웹 브라우저에서 동적으로 변경하는 것, 클라이언트에서 형태를 만들어서 사용한다.

ex) 구글 지도,  Gmail, 구글 캘린더

관련기술 : React 등



### 어디까지 알아야 하나?

백엔드- 서버 사이드 렌더링 기술 : 타임리프 / 정적이고 복잡하지 않을 때 사용 **필수**

CSR은 프론트의 전문 분야, 선택과 집중

백엔드 개발자는 서버, DB, 인프라 등등 수많은 백엔드 기술을 공부해야 한다.

풀스택에 대한 환상을 버리자!



## 자바 웹 기술 역사

1997 서블릿 : HTML 만들기 어려움

1999 JSP : 비지니스 로직까지 너무 많은 역할 담당

서블릿, JSP 조합 MVC 패턴 사용

2000년 초 ~ 2010년 초 MVC 프레임워크 춘추 전국 시대

스트럿츠 + 스프링 코어

**애노테이션 기반의 스프링 MVC가 정리**

**스프링 부트의 등장**

- 서버를 내장 Tomcat



Web Servlet - Spring MVC

Web Reactive - Spring WebFlux



View Template의 역사

JSP -> Freemarker -> ThymeLeaf

타임리프는 스프링 MVC와 강력한 기능 통합 : 최선의 선택

단 성능은 프리마커, 벨로시티가 더 빠름











