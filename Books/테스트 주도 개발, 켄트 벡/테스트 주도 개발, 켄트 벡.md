# 테스트 주도 개발



#### 테스트 주도 개발의 궁극적인 목표: 작동하는 깔끔한 코드

##### 근거:

1. 예측 가능한 개발 방법. 끊임없이 발생할 버그에 대해 걱정하지 않고, 일이 언제 마무리 될지 알 수 있다.
2. 코드가 가르쳐주는 모든 교훈을 학습할 기회를 갖게 된다. 처음 생각나는 대로 후딱 완료해 버리면 두 번째 것, 더 나은 것 에 대해 생각할 기회를 읽게 만든다.
3. 당신이 만든 소프트웨어는 사용자의 삶을 향상시켜 준다.
4. 동료들이 당신을 존경할 수 있게 해주며, 당신 또한 동료들을 존경할 수 있게 된다.
5. 작성하는 동안 기분이 좋다.



##### 규칙:

1. 오직 자동화된 테스트가 실패할 경우에만 새로운 코드를 작성한다.
2. 중복을 제거한다.



##### 책을 읽고나면:

1. 단순하게 시작하고
2. 자동화된 테스트를 만들고
3. 새로운 설계 결정을 한 번에 하나씩 도입하기 위해 리팩토링을 할 준비가 될 것이다.



## 1부. 화폐 예제



#### TDD의 리듬

1. 재빨리 테스트를 하나 추가한다.
2. 모든 테스트를 실행하고 새로 추가한 것이 실패하는지 확인한다.
3. 코드를 조금 바꾼다.
4. 모든 테스트를 실행하고 전부 성공하는지 확인한다.
5. 리팩토링을 통해 중복을 제거한다.



#### 놀랄 포인트

- 각각의 테스트가 기능의 작은 증가분을 어떻게 커버하는지
- 새 테스트를 돌아가게 하기 위해 얼마나 작고 못생긴 변화가 가능한지
- 얼마나 자주 테스트를 실행하는지
- 얼마나 수 없이 작은 단계를 통해 리팩토링이 되어가는지



----------

### 1장. 다중 통화를 지원하는 Money 객체

Money Class

| 종목 | 주   | 가격 | 합계  |
| ---- | ---- | ---- | ----- |
| IBM  | 1000 | 25   | 25000 |
| GE   | 400  | 100  | 40000 |
|      |      | 합계 | 65000 |



다중 통화를 지원하는 Money Class

| 종목 | 주   | 가격   | 합계     |
| ---- | ---- | ------ | -------- |
| IBM  | 1000 | 25USD  | 25000USD |
| GE   | 400  | 150CHF | 60000CHF |
|      |      | 합계   | 65000USD |

환율 Class

| 기준 | 변환 | 환율 |
| ---- | ---- | ---- |
| CHF  | USD  | 1.5  |

-----



#### 필요한 테스트

- 통화가 다른 두 금액을 더해서 주어진 환율에 맞게 변한 금액을 결과로 얻을 수 있어야 한다.
- 어떤 금액(주가)을 어떤 수(주식의 수)에 곱한 금액을 결과로 얻을 수 있어야 한다.

```#### Todo
할 일

$5 + 10CHF = $10 (환율이 2:1일 경우)
$5  x 2  = $10
amount를 private으로 만들기
Dollar 부작용?
Money 반올림?
```



-----

#### Money Class 와 Test 생성

1.  Money Class

![image-20210725212052863](C:\Users\mohai\AppData\Roaming\Typora\typora-user-images\image-20210725212052863.png)



2. MoneyTest

![image-20210725212028449](C:\Users\mohai\AppData\Roaming\Typora\typora-user-images\image-20210725212028449.png)



----

#### 수행한 작업

- 우리가 알고 있는 작업해야 할 테스트 목록을 만들었다.
- 오퍼레이션이 외부에서 어떻게 보이길 원하는지 말해주는 이야기를 코드로 표현했다.
- JUnit에 대한 상세한 사항들을 잠시 무시
- 스텁 구현을 통해 테스트를 컴파일
- 돌아가는 코드에서 상수를 변수로 변경하여 점진적으로 일반화
- 새로운 할일을 처리하지 않고 항 일 목록에 추가하고 넘어갔다.

----

### 2장. 타락한 객체



#### 일반적인 TDD 주기

1. 테스트 작성. 이야기 만들기. 원하는 인터페이스를 개발. 올바른 답을 얻기 위해 필요한 이야기의 모든 요소를 포함
2. 실행 가능하게 만든다. 빨리 초록막대 보기. 깔끔하고 단순한게 명백히 보이면 수행, 아니라면 일단 적어놓고 문제 해결.
3. 올바르게 만든다. 죄악들을 수숩. 중복을 제거하고 초록막대로 되돌리기.

##### 작동하고 깔끔한 코드 중 작동부분을 먼저 해결

```markdown
할 일

$5 + 10CHF = $10 (환율이 2:1일 경우)
~~$5  x 2  = $10~~
amount를 private으로 만들기
Dollar 부작용?
Money 반올림?
```

![image-20210725214147057](C:\Users\mohai\AppData\Roaming\Typora\typora-user-images\image-20210725214147057.png)

![image-20210725214208693](C:\Users\mohai\AppData\Roaming\Typora\typora-user-images\image-20210725214208693.png)



- 가짜로 구현하기: 상수를 반환하게 만들고 진짜 코드를 얻을 때까지 단계적으로 상수를 변수로 바꾸어 간다.
- 명백한 구현 사용하기: 실제 구현을 입력한다.



-----

### 3장. 모두를 위한 평등

```markdown
할 일

$5 + 10CHF = $10 (환율이 2:1일 경우)
~~$5  x 2  = $10~~
amount를 private으로 만들기
~~Dollar 부작용?~~
Money 반올림?
**equals()**
hashCode()
Equal null
Equal object
```



초록막대를 보기 위한 전략 세번째:

- 삼각측량: 예제가 두개 이상있을 때, 비교를 통해 구성



