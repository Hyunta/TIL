# BackSpace: 더 멀리 나아가는 방법



## 들어가며

- 세션에 참석하면서 어떤 목적을 가지고 참석했는지 생각해보자



# AWS SQS를 도입하면서 했던 고민

체널톡에서는 Redis Pubsub을 통해서  Broadcasting을 진행하고 있다. cluster의 확정성을 가지면서 빠르게 처리할 수 있다. 사용자가 많이 때문에 TPS가 높아야 하기 때문에 성능이 중요하다. 하지만 SQS에서는 처리하기가 어렵다. SQS는 늦게 처리되도 되는데 꼭 처리해야하는 경우 사용하는 것이 적절한 것 같다. Kafka와 비슷한 Kinesis는 Batch, Aggregation 같은 Job을 할 떄 Chaining하는 목적으로 사용하고 있다.

- deduplicationID가 중복될 수 있지 않나요?

  UniqueId라는 자료구조를 사용하고 있는데 UUID 같은 것이다. 시간 순으로 중복되는 로직.

  SQS 내부에서 구현한다면 Redis를 사용해서 구현할 것 같다.  Redis에 해당 키 값을 넣어두고 TTL을 걸어둔다. 다음 메시지가 들어왔을 때는 Key 값으로 비교해보고 값이 있으면 사용하지 않는다. 정확한 스펙은 5분 안에 들어왔을 때 같은 id일 경우 처리한다고 되어 있다.

- Polling을 사용한 이유가 있을까요?

  Push는 메시지가 생길 떄 클라이언트에 전달하는 방식이다. Push는 미리 보내줘야할 애들을 등록해놔야한다. 이런 경우 상태가 생긴다. 메시지가 긴급하게 들어왔을 때 Worker를 늘려서 빠르게 처리하고 싶다. 이럴 때는 Polling 방식이 적절한 것 같다. Pushing의 경우 스케일 아웃할 때 고려해야할 사항들이 생긴다.

- 큐가 살아날 때까지 대기하나요?

  선행 메시지가 처리되지 않으면 후행 작업이 이행되지 않는다. DLQ를 같이 구현해서 처리하지 못하는 메세지에 대해서는 DLQ를 이용해야 한다.

- Consume 속도보다 Produce 속도가 빨라서 큐가 터지면 어떡하죠?

  아마존이 처리해줄 것입니다.







​	