# JVM initial 힙과 최대 힙 사이즈

# 학습 동기

힙 메모리를 증설하게 되면서 기존 4기가에서 8기가로 변경하게 됐습니다.

그 와중에 `-Xms` 와 `-Xmx` 명령어가 따로 존재하고 각각 Java Heap의 초기 사이즈와 최대 사이즈를 의미함을 알게됐습니다.

이 해당 값을 어떻게 설정하는게 좋을지? 현재는 둘다 8기가로 동일하게 유지하고 있는데 이게 효율적인지 찾아봤습니다.

# Oracle 문서

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/cd4ae9b2-81c4-4cd4-b996-d70da560c0aa/Untitled.png)

https://docs.oracle.com/cd/E21764_01/web.1111/e13814/jvm_tuning.htm#PERFM160

oracle 공식문서에 나와있기로는 두개의 사이즈를 일치시켜주는 것을 권장한다고 합니다. 힙이 계속 늘어나거나 줄어들 때마다 리소스가 관리하게 되면서 낭비될 수 있기 때문에 어떤 GC를 사용하는지에 무관하게 일치시켜주라고 합니다. 아래 표에 보면 GC를 최소화하기 위해서 값을 같게 유지시켜주라고 합니다.

ChatGPT에도 물어봤습니다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d89570c3-897c-41bc-948a-33dd7ccbac4e/Untitled.png)

힙 사이즈가 너무 작으면 GC가 더 자주 돌아야하기 때문에 overhead가 증가하고 applitcation이 자주 중지될 수 있습니다. 반대로 너무 크게 설정되어 있다면 GC가 한번 수행될 때 시간이 오래걸려서 중지되는 시간이 길어질 수 있습니다.

초기힙과 최대힙의 크기를 일치 시켜놓으면 application이 구동될 때 전체 용량의 메모리를 받아와서 동적으로 힙 사이즈를 변경하지 않아도 되게 됩니다. 이렇게 구성하면 GC가 도는 빈도와 속도를 최소화할 수 있어서 성능을 낫게 만들 수 있습니다.

항상 같을 때 좋은 것은 아니니 모니터링을 통해 최적값을 찾을 수 있다면, 그렇게 하는 것이 더 낫습니다.

# 결론

- 잘 모르면 최소힙과 최대힙을 일치시켜놓자
- 모니터링한 결과를 통해 가끔씩 튀는 결과값이 있으면 조정하자